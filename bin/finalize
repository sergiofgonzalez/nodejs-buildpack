#!/bin/bash
set -euo pipefail

export PACK_STACK_ID="org.cloudfoundry.stacks.$CF_STACK"

BUILD_DIR=$1
CACHE_DIR=$2
DEPS_DIR=$3
DEPS_IDX=$4
LAUNCH_DIR="$BUILD_DIR/.."
PROFILE_DIR=${5:-}

BP_DIR=`dirname $(readlink -f ${BASH_SOURCE%/*})`

# TODO : iterate over the buildpacks listed in the order.toml file instead of hand-coding these
mv $DEPS_DIR/$DEPS_IDX/org.cloudfoundry.buildpacks.nodejs/node/profile.d/* "$PROFILE_DIR"
mv $DEPS_DIR/$DEPS_IDX/org.cloudfoundry.buildpacks.npm/npm/profile.d/* "$PROFILE_DIR"


# TODO : iterate over the buildpacks listed in the order.toml and add any to the path that have a bin
printf "export PATH=\$DEPS_DIR/$DEPS_IDX/org.cloudfoundry.buildpacks.nodejs/node/bin:$PATH" > \
"$PROFILE_DIR/$DEPS_IDX-$PACK_STACK_ID.sh"
